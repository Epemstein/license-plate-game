<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>License Plate Game</title>
    <style>
        @font-face {
            font-family: "RoadgeekUS";
            src: url("fonts/Roadgeek.woff2") format("woff2");
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #fff;
        }

        .container {
            max-width: 1200px;
            width: 100%;
        }

        /* Menu Screen */
        .menu-screen {
            text-align: center;
            display: none;
        }

        .menu-screen.active {
            display: block;
        }

        .menu-title {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 1rem;
            text-shadow: 4px 4px 0 rgba(0,0,0,0.3);
            letter-spacing: 0.1em;
        }

        .menu-subtitle {
            font-size: 1.2rem;
            margin-bottom: 3rem;
            opacity: 0.9;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            max-width: 400px;
            margin: 0 auto;
        }

        .menu-btn {
            padding: 1.5rem 2rem;
            font-size: 1.3rem;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            border: 4px solid #fff;
            background: rgba(255,255,255,0.1);
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .menu-btn:hover {
            background: #fff;
            color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .menu-btn.primary {
            background: #fbbf24;
            border-color: #fbbf24;
            color: #1f2937;
        }

        .menu-btn.primary:hover {
            background: #f59e0b;
            border-color: #f59e0b;
            transform: translateY(-2px) scale(1.05);
        }

        .user-info {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
        }

        /* Game Screen */
        .game-screen {
            display: none;
        }

        .game-screen.active {
            display: block;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1rem;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }

        .game-mode-badge {
            padding: 0.5rem 1rem;
            background: #fbbf24;
            color: #1f2937;
            font-weight: bold;
            border-radius: 4px;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .game-mode-badge.practice {
            background: #8b5cf6;
            color: #fff;
        }

        .timer {
            font-size: 2rem;
            font-weight: bold;
        }

        .progress {
            font-size: 1.2rem;
        }

        .game-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .car-wrapper {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 400px;
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
        }

        .car-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .plate-text {
            position: absolute;
            left: 52%;
            bottom: 26%;
            transform: translateX(-50%);
            font-family: "RoadgeekUS", sans-serif;
            font-size: 3rem;
            letter-spacing: 0.33em;
            color: #222;
            font-weight: 400;
            text-transform: uppercase;
            text-shadow: 0 1px 2px rgba(0,0,0,0.35);
            pointer-events: none;
        }

        .difficulty {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            padding: 0.5rem;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
        }

        .diff-easy { color: #10b981; }
        .diff-med { color: #f59e0b; }
        .diff-hard { color: #ef4444; }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .input-row {
            display: flex;
            gap: 0.5rem;
        }

        .word-input {
            flex: 1;
            padding: 1rem;
            font-size: 1.2rem;
            font-family: 'Courier New', Courier, monospace;
            border: 3px solid #fff;
            background: rgba(255,255,255,0.9);
            color: #1f2937;
            text-transform: uppercase;
        }

        .btn {
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            border: 3px solid #fff;
            background: rgba(255,255,255,0.1);
            color: #fff;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
        }

        .btn:hover:not(:disabled) {
            background: #fff;
            color: #667eea;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .btn.primary {
            background: #10b981;
            border-color: #10b981;
        }

        .btn.primary:hover:not(:disabled) {
            background: #059669;
            border-color: #059669;
            color: #fff;
        }

        .btn.skip {
            background: #f59e0b;
            border-color: #f59e0b;
            color: #1f2937;
        }

        .btn.skip:hover:not(:disabled) {
            background: #d97706;
            border-color: #d97706;
        }

        .result {
            padding: 1rem;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
            min-height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .right-panel {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 1.5rem;
            max-height: 600px;
            overflow-y: auto;
        }

        .history-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            text-align: center;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .history-item {
            padding: 0.75rem;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid transparent;
        }

        .history-item.solved {
            border-left-color: #10b981;
        }

        .history-item.skipped {
            border-left-color: #f59e0b;
        }

        .history-plate {
            font-weight: bold;
            letter-spacing: 0.2em;
        }

        .history-word {
            font-style: italic;
        }

        .history-time {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Leaderboard Screen */
        .leaderboard-screen {
            display: none;
            text-align: center;
        }

        .leaderboard-screen.active {
            display: block;
        }

        .leaderboard-title {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 2rem;
            text-shadow: 4px 4px 0 rgba(0,0,0,0.3);
        }

        .leaderboard-date {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .leaderboard-table {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            max-height: 500px;
            overflow-y: auto;
        }

        .leaderboard-entry {
            display: grid;
            grid-template-columns: 60px 1fr 120px;
            padding: 1rem;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            margin-bottom: 0.5rem;
            align-items: center;
        }

        .leaderboard-entry.top3 {
            background: rgba(251,191,36,0.2);
            border: 2px solid #fbbf24;
        }

        .leaderboard-rank {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .leaderboard-name {
            text-align: left;
            font-size: 1.1rem;
        }

        .leaderboard-score {
            text-align: right;
            font-weight: bold;
            font-size: 1.2rem;
        }

        /* Game Over Modal */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 3rem;
            border-radius: 12px;
            max-width: 500px;
            text-align: center;
            border: 4px solid #fff;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .modal-title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .modal-stats {
            font-size: 1.2rem;
            margin: 2rem 0;
            line-height: 1.8;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .loading {
            text-align: center;
            font-size: 1.5rem;
            padding: 3rem;
        }

        @media (max-width: 768px) {
            .game-content {
                grid-template-columns: 1fr;
            }

            .menu-title {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <!-- Menu Screen -->
    <div class="menu-screen active" id="menuScreen">
        <h1 class="menu-title">üöó LICENSE PLATE GAME</h1>
        <p class="menu-subtitle">Make words from license plate letters!</p>
        
        <div class="menu-buttons">
            <button class="menu-btn primary" id="dailyChallengeBtn">
                Daily Challenge
            </button>
            <button class="menu-btn" id="practiceBtn">
                Practice Mode
            </button>
            <button class="menu-btn" id="leaderboardBtn">
                View Leaderboard
            </button>
        </div>

        <div class="user-info" id="userInfo" style="display: none;">
            <p>Signed in as: <strong id="userName"></strong></p>
            <button class="menu-btn" id="signOutBtn" style="margin-top: 1rem;">Sign Out</button>
        </div>
    </div>

    <!-- Game Screen -->
    <div class="game-screen" id="gameScreen">
        <div class="game-header">
            <div class="game-mode-badge" id="modeBadge">Daily Challenge</div>
            <div class="timer" id="timer">0:00</div>
            <div class="progress" id="progress">0/20</div>
        </div>

        <div class="game-content">
            <div class="left-panel">
                <div class="car-wrapper">
                    <img src="car.png" alt="Car" class="car-image">
                    <div class="plate-text" id="plateText">ABC</div>
                </div>
                <div class="difficulty" id="difficulty">
                    <span class="diff-easy">Easy</span>
                </div>
                <div class="controls">
                    <div class="input-row">
                        <input type="text" class="word-input" id="wordInput" placeholder="Type your word..." autocomplete="off">
                        <button class="btn primary" id="submitBtn">Submit</button>
                    </div>
                    <button class="btn skip" id="skipBtn">Skip (+5s penalty)</button>
                    <div class="result" id="result"></div>
                </div>
                <button class="btn" id="backBtn">Back to Menu</button>
            </div>

            <div class="right-panel">
                <h2 class="history-title">History</h2>
                <div class="history-list" id="historyList">
                    <p style="opacity: 0.6;">No attempts yet</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaderboard Screen -->
    <div class="leaderboard-screen" id="leaderboardScreen">
        <h1 class="leaderboard-title">üèÜ Daily Leaderboard</h1>
        <p class="leaderboard-date" id="leaderboardDate"></p>
        
        <div class="leaderboard-table" id="leaderboardTable">
            <div class="loading">Loading scores...</div>
        </div>

        <button class="menu-btn" id="backFromLeaderboardBtn">Back to Menu</button>
    </div>

    <!-- Game Over Modal -->
    <div class="modal" id="gameOverModal">
        <div class="modal-content">
            <h2 class="modal-title">üéâ Game Complete!</h2>
            <div class="modal-stats" id="finalStats"></div>
            <div class="modal-buttons">
                <button class="menu-btn" id="viewLeaderboardBtn">View Leaderboard</button>
                <button class="menu-btn" id="backToMenuBtn">Back to Menu</button>
            </div>
        </div>
    </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
// ============================================================================
// FIREBASE CONFIGURATION - YOUR ACTUAL CONFIG
// ============================================================================
const firebaseConfig = {
    apiKey: "AIzaSyBEa4aJf-cB25uzvEXdpNf1bG5kOOL5PXs",
    authDomain: "license-plate-game-2ea96.firebaseapp.com",
    databaseURL: "https://license-plate-game-2ea96-default-rtdb.firebaseio.com",
    projectId: "license-plate-game-2ea96",
    storageBucket: "license-plate-game-2ea96.firebasestorage.app",
    messagingSenderId: "247985429580",
    appId: "1:247985429580:web:4927cee2ca3581b569a8e9"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const database = firebase.database();

// ============================================================================
// GAME CONSTANTS
// ============================================================================
const TOTAL_PLATES = 20;
const SKIP_PENALTY = 5;

// Predefined plates with difficulties
const ALL_PLATES = [
    { plate: "ABC", difficulty: "easy" },
    { plate: "CAT", difficulty: "easy" },
    { plate: "DOG", difficulty: "easy" },
    { plate: "FUN", difficulty: "easy" },
    { plate: "BIG", difficulty: "easy" },
    { plate: "RUN", difficulty: "easy" },
    { plate: "HAT", difficulty: "easy" },
    { plate: "BAT", difficulty: "easy" },
    { plate: "RAT", difficulty: "easy" },
    { plate: "SIT", difficulty: "easy" },
    { plate: "BRN", difficulty: "med" },
    { plate: "STR", difficulty: "med" },
    { plate: "PLT", difficulty: "med" },
    { plate: "GRN", difficulty: "med" },
    { plate: "FLT", difficulty: "med" },
    { plate: "DRK", difficulty: "med" },
    { plate: "CRN", difficulty: "med" },
    { plate: "TRN", difficulty: "med" },
    { plate: "XYZ", difficulty: "hard" },
    { plate: "QZX", difficulty: "hard" },
    { plate: "JXK", difficulty: "hard" },
    { plate: "VWX", difficulty: "hard" },
    { plate: "XPT", difficulty: "hard" },
    { plate: "ZQK", difficulty: "hard" },
];

// Simple dictionary
const SIMPLE_DICTIONARY = new Set([
    "ABOUT", "ABOVE", "ACROSS", "AFTER", "AGAIN", "AGAINST", "ALL", "ALMOST", "ALONE",
    "ALONG", "ALREADY", "ALSO", "ALTHOUGH", "ALWAYS", "AMONG", "ANOTHER", "ANY",
    "ANYONE", "ANYTHING", "AROUND", "BACK", "BARN", "BECOME", "BEFORE", "BEGIN",
    "BEHIND", "BEING", "BELOW", "BETWEEN", "BOTH", "BRING", "BUILD", "CABIN",
    "CALL", "CAME", "CANNOT", "CAPTAIN", "CERTAIN", "CHANGE", "CHILD", "CHILDREN",
    "COME", "CORN", "COULD", "COUNTRY", "DARK", "DIFFERENT", "DOES", "DONE",
    "DOWN", "DURING", "EACH", "EARLY", "EARTH", "ENOUGH", "EVEN", "EVERY",
    "EVERYTHING", "FACT", "FAMILY", "FARM", "FATHER", "FEEL", "FELL", "FELT",
    "FIND", "FIRST", "FLAT", "FOLLOW", "FOUND", "FOUR", "FROM", "FULL",
    "GAVE", "GENERAL", "GIVE", "GIVEN", "GRAIN", "GREAT", "GREEN", "GROUND",
    "GROUP", "GROW", "HALF", "HAND", "HARD", "HAVE", "HEAD", "HEAR",
    "HEARD", "HELP", "HERE", "HIGH", "HOLD", "HOME", "HOPE", "HORSE",
    "HOUSE", "INTO", "JUST", "KEEP", "KEPT", "KIND", "KING", "KNOW",
    "KNOWN", "LAND", "LARGE", "LAST", "LATE", "LATER", "LEAD", "LEARN",
    "LEAST", "LEAVE", "LEFT", "LESS", "LETTER", "LIFE", "LIGHT", "LIKE",
    "LINE", "LIST", "LISTEN", "LITTLE", "LIVE", "LONG", "LOOK", "MADE",
    "MAKE", "MANY", "MARK", "MEAN", "MIGHT", "MILE", "MIND", "MONEY",
    "MORE", "MORNING", "MOST", "MOTHER", "MOVE", "MUCH", "MUST", "NAME",
    "NEAR", "NEED", "NEVER", "NEXT", "NIGHT", "NORTH", "NOTE", "NOTICE",
    "NUMBER", "OFTEN", "ONCE", "ONLY", "OPEN", "ORDER", "OTHER", "OVER",
    "OWN", "PAGE", "PART", "PASS", "PEOPLE", "PERHAPS", "PLACE", "PLAIN",
    "PLANT", "PLAY", "POINT", "POWER", "PRESENT", "PUT", "QUESTION", "QUITE",
    "RATHER", "READ", "READY", "REAL", "REALLY", "RIGHT", "ROOM", "ROUND",
    "SAME", "SCHOOL", "SEEM", "SEEN", "SEND", "SENT", "SEVERAL", "SHALL",
    "SHIP", "SHORT", "SHOULD", "SHOW", "SIDE", "SINCE", "SMALL", "SOMETHING",
    "SOON", "SOUND", "SOUTH", "SPELL", "STAND", "START", "STATE", "STILL",
    "STORY", "STRONG", "STUDY", "SUCH", "SURE", "TAKE", "TAKEN", "TELL",
    "THAN", "THAT", "THEIR", "THEM", "THEN", "THERE", "THESE", "THEY",
    "THING", "THINK", "THIS", "THOSE", "THOUGH", "THOUGHT", "THREE", "THROUGH",
    "TIME", "TOGETHER", "TOLD", "TOOK", "TOWN", "TRAIN", "TREE", "TRUE",
    "TURN", "UNDER", "UNTIL", "UPON", "USED", "VERY", "WAIT", "WALK",
    "WANT", "WARM", "WATCH", "WATER", "WELL", "WENT", "WERE", "WEST",
    "WHAT", "WHEN", "WHERE", "WHICH", "WHILE", "WHITE", "WHOLE", "WILL",
    "WITH", "WITHIN", "WITHOUT", "WORD", "WORK", "WORLD", "WOULD", "WRITE",
    "WRITTEN", "YEAR", "YOUNG", "YOUR"
]);

// ============================================================================
// GAME STATE
// ============================================================================
let currentUser = null;
let gameMode = null;
let currentPlate = null;
let gameHistory = [];
let startTime = null;
let plateStartTime = null;
let timerInterval = null;
let dailySeed = null;

// ============================================================================
// UI ELEMENTS
// ============================================================================
const menuScreen = document.getElementById('menuScreen');
const gameScreen = document.getElementById('gameScreen');
const leaderboardScreen = document.getElementById('leaderboardScreen');
const dailyChallengeBtn = document.getElementById('dailyChallengeBtn');
const practiceBtn = document.getElementById('practiceBtn');
const leaderboardBtn = document.getElementById('leaderboardBtn');
const userInfo = document.getElementById('userInfo');
const userName = document.getElementById('userName');
const signOutBtn = document.getElementById('signOutBtn');
const modeBadge = document.getElementById('modeBadge');
const timer = document.getElementById('timer');
const progress = document.getElementById('progress');
const plateText = document.getElementById('plateText');
const difficulty = document.getElementById('difficulty');
const wordInput = document.getElementById('wordInput');
const submitBtn = document.getElementById('submitBtn');
const skipBtn = document.getElementById('skipBtn');
const result = document.getElementById('result');
const historyList = document.getElementById('historyList');
const backBtn = document.getElementById('backBtn');
const leaderboardTable = document.getElementById('leaderboardTable');
const leaderboardDate = document.getElementById('leaderboardDate');
const backFromLeaderboardBtn = document.getElementById('backFromLeaderboardBtn');
const gameOverModal = document.getElementById('gameOverModal');
const finalStats = document.getElementById('finalStats');
const viewLeaderboardBtn = document.getElementById('viewLeaderboardBtn');
const backToMenuBtn = document.getElementById('backToMenuBtn');

// ============================================================================
// AUTHENTICATION
// ============================================================================
auth.onAuthStateChanged((user) => {
    currentUser = user;
    if (user) {
        userInfo.style.display = 'block';
        userName.textContent = user.displayName || user.email;
    } else {
        userInfo.style.display = 'none';
    }
});

async function signInWithGoogle() {
    try {
        const provider = new firebase.auth.GoogleAuthProvider();
        await auth.signInWithPopup(provider);
        return true;
    } catch (error) {
        console.error('Sign in error:', error);
        alert('Failed to sign in. Please try again.');
        return false;
    }
}

signOutBtn.addEventListener('click', () => {
    auth.signOut();
});

// ============================================================================
// DAILY CHALLENGE LOGIC
// ============================================================================
function getTodayString() {
    const now = new Date();
    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
}

function generateDailyPlates(dateString) {
    const seed = dateString.split('-').reduce((acc, val) => acc + parseInt(val), 0);
    const rng = seededRandom(seed);
    const shuffled = [...ALL_PLATES].sort(() => rng() - 0.5);
    return shuffled.slice(0, TOTAL_PLATES);
}

function seededRandom(seed) {
    let value = seed;
    return function() {
        value = (value * 9301 + 49297) % 233280;
        return value / 233280;
    };
}

async function checkIfPlayedToday() {
    if (!currentUser) return false;
    const today = getTodayString();
    const snapshot = await database.ref(`scores/${today}/${currentUser.uid}`).once('value');
    return snapshot.exists();
}

async function saveScore(totalTime, solvedCount, skippedCount) {
    if (!currentUser || gameMode !== 'daily') return;
    const today = getTodayString();
    const score = {
        userId: currentUser.uid,
        userName: currentUser.displayName || currentUser.email,
        totalTime: totalTime,
        solved: solvedCount,
        skipped: skippedCount,
        timestamp: Date.now()
    };
    await database.ref(`scores/${today}/${currentUser.uid}`).set(score);
}

async function loadLeaderboard(dateString) {
    const snapshot = await database.ref(`scores/${dateString}`).once('value');
    const scores = [];
    snapshot.forEach((child) => {
        scores.push(child.val());
    });
    scores.sort((a, b) => a.totalTime - b.totalTime);
    return scores;
}

// ============================================================================
// GAME LOGIC
// ============================================================================
function checkPlateMatch(plate, word) {
    const plateLetters = plate.split('');
    const wordLetters = word.toUpperCase().split('');
    let plateIndex = 0;
    for (const letter of wordLetters) {
        const foundIndex = plateLetters.indexOf(letter, plateIndex);
        if (foundIndex === -1) return false;
        plateIndex = foundIndex + 1;
    }
    return true;
}

function startGame(mode) {
    gameMode = mode;
    gameHistory = [];
    startTime = Date.now();
    
    if (mode === 'daily') {
        dailySeed = generateDailyPlates(getTodayString());
        modeBadge.textContent = 'Daily Challenge';
        modeBadge.classList.remove('practice');
    } else {
        dailySeed = [...ALL_PLATES].sort(() => Math.random() - 0.5).slice(0, TOTAL_PLATES);
        modeBadge.textContent = 'Practice Mode';
        modeBadge.classList.add('practice');
    }
    
    menuScreen.classList.remove('active');
    gameScreen.classList.add('active');
    nextPlate();
    startTimer();
}

function nextPlate() {
    const plateIndex = gameHistory.length;
    if (plateIndex >= TOTAL_PLATES) {
        endGame();
        return;
    }
    
    const plateData = dailySeed[plateIndex];
    currentPlate = plateData.plate;
    plateStartTime = Date.now();
    plateText.textContent = currentPlate;
    
    const diffClass = `diff-${plateData.difficulty}`;
    difficulty.innerHTML = `<span class="${diffClass}">${plateData.difficulty.toUpperCase()}</span>`;
    progress.textContent = `${plateIndex}/${TOTAL_PLATES}`;
    wordInput.value = '';
    result.textContent = '';
    wordInput.focus();
}

function startTimer() {
    timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const minutes = Math.floor(elapsed / 60);
        const seconds = elapsed % 60;
        timer.textContent = `${minutes}:${String(seconds).padStart(2, '0')}`;
    }, 1000);
}

function submitWord() {
    const word = wordInput.value.trim().toUpperCase();
    
    if (!word) {
        result.textContent = '‚ùå Please enter a word';
        result.style.color = '#ef4444';
        return;
    }
    
    if (!SIMPLE_DICTIONARY.has(word)) {
        result.textContent = `‚ùå "${word}" is not in the dictionary`;
        result.style.color = '#ef4444';
        return;
    }
    
    if (!checkPlateMatch(currentPlate, word)) {
        result.textContent = `‚ùå "${word}" doesn't match ${currentPlate}`;
        result.style.color = '#ef4444';
        return;
    }
    
    const thinkTime = ((Date.now() - plateStartTime) / 1000).toFixed(1);
    result.textContent = `‚úÖ "${word}" matches!`;
    result.style.color = '#10b981';
    
    gameHistory.push({
        plate: currentPlate,
        word: word.toLowerCase(),
        skipped: false,
        time: parseFloat(thinkTime)
    });
    
    addHistoryItem(currentPlate, word.toLowerCase(), thinkTime, false);
    setTimeout(() => nextPlate(), 1000);
}

function skipPlate() {
    const thinkTime = ((Date.now() - plateStartTime) / 1000).toFixed(1);
    const totalTime = parseFloat(thinkTime) + SKIP_PENALTY;
    
    result.textContent = `‚è© Skipped! +${SKIP_PENALTY}s penalty`;
    result.style.color = '#f59e0b';
    
    gameHistory.push({
        plate: currentPlate,
        word: 'skipped',
        skipped: true,
        time: totalTime
    });
    
    addHistoryItem(currentPlate, 'skipped', `${totalTime.toFixed(1)}`, true);
    setTimeout(() => nextPlate(), 1000);
}

function addHistoryItem(plate, word, time, skipped) {
    if (historyList.children[0]?.tagName === 'P') {
        historyList.innerHTML = '';
    }
    
    const item = document.createElement('div');
    item.className = `history-item ${skipped ? 'skipped' : 'solved'}`;
    item.innerHTML = `
        <span class="history-plate">${plate}</span>
        <span class="history-word">${word}</span>
        <span class="history-time">${time}s</span>
    `;
    historyList.appendChild(item);
}

async function endGame() {
    clearInterval(timerInterval);
    
    const totalTime = Math.floor((Date.now() - startTime) / 1000);
    const solvedCount = gameHistory.filter(h => !h.skipped).length;
    const skippedCount = gameHistory.filter(h => h.skipped).length;
    
    const minutes = Math.floor(totalTime / 60);
    const seconds = totalTime % 60;
    
    finalStats.innerHTML = `
        <p><strong>Total Time:</strong> ${minutes}:${String(seconds).padStart(2, '0')}</p>
        <p><strong>Solved:</strong> ${solvedCount}/${TOTAL_PLATES}</p>
        <p><strong>Skipped:</strong> ${skippedCount}</p>
    `;
    
    if (gameMode === 'daily' && currentUser) {
        await saveScore(totalTime, solvedCount, skippedCount);
        finalStats.innerHTML += `<p style="margin-top: 1rem; color: #10b981;">‚úÖ Score saved to leaderboard!</p>`;
    }
    
    gameOverModal.classList.add('active');
}

function backToMenu() {
    gameScreen.classList.remove('active');
    leaderboardScreen.classList.remove('active');
    menuScreen.classList.add('active');
    gameOverModal.classList.remove('active');
    clearInterval(timerInterval);
    historyList.innerHTML = '<p style="opacity: 0.6;">No attempts yet</p>';
}

async function showLeaderboard() {
    menuScreen.classList.remove('active');
    gameScreen.classList.remove('active');
    gameOverModal.classList.remove('active');
    leaderboardScreen.classList.add('active');
    
    const today = getTodayString();
    leaderboardDate.textContent = `Daily Challenge - ${today}`;
    leaderboardTable.innerHTML = '<div class="loading">Loading scores...</div>';
    
    const scores = await loadLeaderboard(today);
    
    if (scores.length === 0) {
        leaderboardTable.innerHTML = '<p style="opacity: 0.6;">No scores yet today. Be the first!</p>';
        return;
    }
    
    leaderboardTable.innerHTML = '';
    scores.forEach((score, index) => {
        const minutes = Math.floor(score.totalTime / 60);
        const seconds = score.totalTime % 60;
        const timeStr = `${minutes}:${String(seconds).padStart(2, '0')}`;
        
        const entry = document.createElement('div');
        entry.className = `leaderboard-entry ${index < 3 ? 'top3' : ''}`;
        entry.innerHTML = `
            <div class="leaderboard-rank">#${index + 1}</div>
            <div class="leaderboard-name">${score.userName}</div>
            <div class="leaderboard-score">${timeStr}</div>
        `;
        leaderboardTable.appendChild(entry);
    });
}

// ============================================================================
// EVENT LISTENERS
// ============================================================================
dailyChallengeBtn.addEventListener('click', async () => {
    if (!currentUser) {
        const signedIn = await signInWithGoogle();
        if (!signedIn) return;
    }
    
    const played = await checkIfPlayedToday();
    if (played) {
        alert('You already played today\'s challenge! Come back tomorrow, or try Practice Mode.');
        return;
    }
    
    startGame('daily');
});

practiceBtn.addEventListener('click', () => {
    startGame('practice');
});

leaderboardBtn.addEventListener('click', () => {
    showLeaderboard();
});

submitBtn.addEventListener('click', submitWord);

wordInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') submitWord();
});

skipBtn.addEventListener('click', skipPlate);
backBtn.addEventListener('click', backToMenu);
backFromLeaderboardBtn.addEventListener('click', backToMenu);
viewLeaderboardBtn.addEventListener('click', showLeaderboard);
backToMenuBtn.addEventListener('click', backToMenu);

</script>

</body>
</html>
