<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>License Plate Game v4</title>
    <style>
        :root {
            --bg: #0f172a;
            --card-bg: #111827;
            --accent: #3b82f6;
            --accent-soft: rgba(59, 130, 246, 0.2);
            --text-main: #f9fafb;
            --text-muted: #9ca3af;
            --error: #f97373;
            --success: #4ade80;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at top, #1f2937 0, #020617 55%);
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            color: var(--text-main);
        }

        .app-shell {
            width: 100%;
            max-width: 700px;
            margin: 24px;
            padding: 24px 24px 20px;
            background: var(--card-bg);
            border-radius: 18px;
            box-shadow:
                0 20px 45px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(148, 163, 184, 0.15);
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 8px;
        }

        h1 {
            margin: 0;
            font-size: 1.4rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }

        .tagline {
            margin: 0;
            font-size: 0.8rem;
            color: var(--text-muted);
            text-align: right;
            white-space: nowrap;
        }

        .explanation {
            margin: 4px 0 16px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .explanation strong {
            color: var(--text-main);
        }

        .plate-wrapper {
            display: flex;
            justify-content: center;
            margin: 20px 0 18px;
        }

        .plate-box {
            position: relative;
            padding: 14px 36px;
            min-width: 220px;
            text-align: center;
            font-size: 2.4rem;
            letter-spacing: 0.5rem;
            background: linear-gradient(145deg, #f9fafb, #e5e7eb);
            color: #111827;
            border-radius: 14px;
            box-shadow:
                0 12px 25px rgba(0, 0, 0, 0.35),
                0 0 0 3px #1d4ed8,
                0 0 0 6px rgba(15, 23, 42, 0.9);
            text-transform: uppercase;
        }

        .plate-box::before,
        .plate-box::after {
            content: "";
            position: absolute;
            top: 50%;
            width: 10px;
            height: 10px;
            border-radius: 999px;
            border: 2px solid #9ca3af;
            transform: translateY(-50%);
            background: #e5e7eb;
        }

        .plate-box::before {
            left: 10px;
        }

        .plate-box::after {
            right: 10px;
        }

        .controls {
            margin-top: 8px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .controls input[type="text"] {
            flex: 1;
            min-width: 190px;
            padding: 9px 12px;
            font-size: 0.95rem;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.5);
            background: rgba(15, 23, 42, 0.9);
            color: var(--text-main);
            outline: none;
            transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
        }

        .controls input[type="text"]::placeholder {
            color: #6b7280;
        }

        .controls input[type="text"]:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 1px var(--accent-soft);
            background: rgba(15, 23, 42, 1);
        }

        button {
            padding: 9px 16px;
            font-size: 0.9rem;
            font-weight: 500;
            border-radius: 999px;
            border: 1px solid transparent;
            cursor: pointer;
            background: rgba(30, 64, 175, 0.95);
            color: #e5e7eb;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            transition: background 0.12s ease, transform 0.08s ease, box-shadow 0.12s ease, border-color 0.12s ease;
            white-space: nowrap;
        }

        button:hover {
            background: #2563eb;
            box-shadow: 0 4px 10px rgba(37, 99, 235, 0.35);
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
            box-shadow: none;
        }

        #newPlateButton {
            background: transparent;
            border-color: rgba(148, 163, 184, 0.6);
            color: var(--text-main);
        }

        #newPlateButton:hover {
            background: rgba(30, 64, 175, 0.3);
            border-color: var(--accent);
        }

        #result {
            margin-top: 14px;
            font-weight: 500;
            min-height: 1.2em;
        }

        #debug {
            margin-top: 6px;
            font-size: 0.78rem;
            color: var(--text-muted);
        }

        .result-success {
            color: var(--success) !important;
        }

        .result-error {
            color: var(--error) !important;
        }

        @media (max-width: 520px) {
            .app-shell {
                margin: 12px;
                padding: 18px 16px 16px;
            }

            .plate-box {
                min-width: 0;
                width: 100%;
                font-size: 2.1rem;
                letter-spacing: 0.4rem;
                padding-inline: 28px;
            }

            h1 {
                font-size: 1.2rem;
            }

            .tagline {
                font-size: 0.72rem;
            }
        }
    </style>
</head>
<body>
    <div class="app-shell">
        <header>
            <h1>License Plate Game</h1>
            <p class="tagline">Find a word that fits the plate.</p>
        </header>

        <p class="explanation">
            The three letters on the plate must appear in your word in this order (not necessarily consecutively).
            If a later plate letter appears before an earlier one
            (like <strong>spams</strong> for <strong>PMS</strong>), it’s invalid.
        </p>

        <div class="plate-wrapper">
            <div class="plate-box" id="plate">---</div>
        </div>

        <div class="controls">
            <input id="wordInput" type="text" placeholder="Type a word that matches the plate">
            <button id="checkButton">Check word</button>
            <button id="newPlateButton">New plate</button>
        </div>

        <div id="result"></div>
        <div id="debug"></div>
    </div>

    <script>
        // ===== 1. Globals =====
        let WORDS = [];             // all words from words.txt (lowercase)
        let DICTIONARY = new Set(); // uppercase, for fast lookup
        let dictionaryReady = false;
        let currentPlate = null;

        const plateEl = document.getElementById("plate");
        const wordInputEl = document.getElementById("wordInput");
        const resultEl = document.getElementById("result");
        const debugEl = document.getElementById("debug");
        const checkButtonEl = document.getElementById("checkButton");
        const newPlateButtonEl = document.getElementById("newPlateButton");

        // ===== 2. Core plate-matching logic (your PMS rule) =====
        function wordMatchesPlate(plate, word) {
            plate = plate.toUpperCase();
            word = word.toUpperCase();

            let expectedPlateIndex = 0; // which plate letter we're expecting next

            for (let i = 0; i < word.length; i++) {
                const ch = word[i];

                // Is this character one of the plate letters?
                const posInPlate = plate.indexOf(ch);

                if (posInPlate === -1) {
                    // Not in the plate at all -> ignore it
                    continue;
                }

                if (posInPlate === expectedPlateIndex) {
                    // We saw exactly the letter we were waiting for (e.g. P, then M, then S)
                    expectedPlateIndex++;

                    // If we've matched all plate letters in order, it's a valid word
                    if (expectedPlateIndex === plate.length) {
                        return true;
                    }
                } else if (posInPlate > expectedPlateIndex) {
                    // We saw a *later* plate letter before an earlier one.
                    // Example: plate PMS, word "spams":
                    // The first S appears before we've ever seen P -> invalid.
                    return false;
                } else {
                    // posInPlate < expectedPlateIndex:
                    // We've already passed this plate letter (e.g., another P after we've moved on to M).
                    // That’s fine; just ignore it.
                    continue;
                }
            }

            // If we finish the loop without matching all plate letters, it's not valid
            return false;
        }

        // ===== 3. Generate a plate from a single word (lazy approach) =====
        function generatePlateFromWord(word) {
            const upper = word.toUpperCase();
            const len = upper.length;

            if (len < 3) return null;

            // Try a few times to find 3 positions with distinct letters
            for (let attempts = 0; attempts < 50; attempts++) {
                const i = Math.floor(Math.random() * (len - 2));
                const j = i + 1 + Math.floor(Math.random() * (len - i - 2));
                const k = j + 1 + Math.floor(Math.random() * (len - j - 1));

                const a = upper[i];
                const b = upper[j];
                const c = upper[k];

                if (a === b || a === c || b === c) continue;

                const plate = a + b + c;

                // Sanity check: word should match this plate by our own rules
                if (wordMatchesPlate(plate, upper)) {
                    return plate;
                }
            }

            return null;
        }

        // ===== 4. Pick a random plate using lazy generation =====
        function pickRandomPlate() {
            if (!dictionaryReady) {
                resultEl.textContent = "Dictionary not loaded yet.";
                resultEl.className = "result-error";
                return;
            }

            if (WORDS.length === 0) {
                plateEl.textContent = "ERR";
                resultEl.textContent = "No words available. Check words.txt.";
                resultEl.className = "result-error";
                return;
            }

            // Try multiple times to find a good plate from random words
            for (let attempts = 0; attempts < 500; attempts++) {
                const idx = Math.floor(Math.random() * WORDS.length);
                const word = WORDS[idx];
                const plate = generatePlateFromWord(word);
                if (plate) {
                    currentPlate = plate;
                    plateEl.textContent = currentPlate;
                    resultEl.textContent = "";
                    resultEl.className = "";
                    wordInputEl.value = "";
                    wordInputEl.focus();
                    debugEl.textContent = `Plate ${currentPlate} generated from a dictionary word. Loaded ${WORDS.length.toLocaleString()} words.`;
                    return;
                }
            }

            // If we somehow fail after many tries:
            plateEl.textContent = "ERR";
            resultEl.textContent = "Could not generate a plate. Try reloading.";
            resultEl.className = "result-error";
        }

        // ===== 5. Dictionary loading =====
        async function loadDictionary() {
            try {
                const response = await fetch("words.txt");
                if (!response.ok) {
                    throw new Error("Failed to load words.txt: " + response.status);
                }

                const text = await response.text();
                const lines = text.split(/\r?\n/);

                WORDS = [];
                DICTIONARY = new Set();

                for (const line of lines) {
                    const w = line.trim().toLowerCase();
                    if (!w) continue;
                    if (!/^[a-z]+$/.test(w)) continue; // letters only

                    // keep words length >= 3 (for plates). We do NOT cap max length.
                    if (w.length < 3) continue;

                    WORDS.push(w);
                    DICTIONARY.add(w.toUpperCase());
                }

                dictionaryReady = true;
                debugEl.textContent = `Loaded ${WORDS.length.toLocaleString()} words.`;
                pickRandomPlate();
            } catch (err) {
                console.error("Error loading dictionary:", err);
                resultEl.textContent = "Error loading dictionary. Check console / words.txt.";
                resultEl.className = "result-error";
            }
        }

        // ===== 6. Check a guess =====
        function checkWord() {
            const rawWord = wordInputEl.value.trim();

            if (!rawWord) {
                resultEl.textContent = "Please type a word first.";
                resultEl.className = "result-error";
                return;
            }

            if (!/^[a-zA-Z]+$/.test(rawWord)) {
                resultEl.textContent = "Please use letters only (A–Z).";
                resultEl.className = "result-error";
                return;
            }

            if (!dictionaryReady) {
                resultEl.textContent = "Dictionary still loading. Try again in a moment.";
                resultEl.className = "result-error";
                return;
            }

            if (!currentPlate) {
                resultEl.textContent = "No plate yet. Click 'New plate'.";
                resultEl.className = "result-error";
                return;
            }

            const upperWord = rawWord.toUpperCase();

            // 1) Check dictionary
            if (!DICTIONARY.has(upperWord)) {
                resultEl.textContent = `❌ "${rawWord}" is not in my dictionary.`;
                resultEl.className = "result-error";
                return;
            }

            // 2) Check plate-matching rule
            const isMatch = wordMatchesPlate(currentPlate, upperWord);

            if (isMatch) {
                resultEl.textContent = `✅ "${rawWord}" is a valid dictionary word for plate ${currentPlate}.`;
                resultEl.className = "result-success";
            } else {
                resultEl.textContent = `❌ "${rawWord}" is in the dictionary but does NOT match plate ${currentPlate} in the correct order.`;
                resultEl.className = "result-error";
            }
        }

        // ===== 7. Hook up events and start =====
        checkButtonEl.addEventListener("click", checkWord);

        wordInputEl.addEventListener("keydown", function (event) {
            if (event.key === "Enter") {
                checkWord();
            }
        });

        newPlateButtonEl.addEventListener("click", function () {
            pickRandomPlate();
        });

        // Kick off dictionary loading on page load
        loadDictionary();
    </script>
</body>
</html>
